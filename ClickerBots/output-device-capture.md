# Перехват устройств вывода

В этом разделе мы рассмотрим методы перехвата данных с устройств вывода. Сначала мы изучим возможности Windows для вывода изображений на экран, которыми пользуются игровые приложения. Затем рассмотрим способы доступа к этим изображениям.

## Интерфейс графических устройств Windows

**Интерфейс графических устройств** (Graphics Device Interface или GDI) - один из основных компонентов Windows, который отвечает за представление графических объектов и передачу их на устройства вывода. Обычно все элементы интерфейса окна приложения конструируются с использованием графических объектов, таких как **контекст устройства** (device context или DC), битовые карты (bitmap), кисти, цвета, шрифты.

Ключевая концепция GDI - это контекст устройства. Он представляет собой абстракцию, благодаря которой разработчики могут единообразно работать с графическими объектами независимо от устройства вывода. Примеры таких устройств: монитор, принтер, плоттер и т.д. Сначала все операции по подготовке изображения выполняются над контекстом устройства в памяти. Затем готовый результат отправляется на устройство вывода.

На иллюстрации 2-7 изображены два контекста устройств, которые содержат изображения окон двух приложений. Так же есть DC, который соответствует итоговому изображению всего рабочего стола. ОС может получить это изображение путем комбинации всех видимых окон и визуальных элементов рабочего стола (например панели задач). Когда этот контекст устройства готов, ОС выводит его содержимое на экран.

![GDI](gdi-scheme.png)

**Иллюстрация 2-7.** *Отображение графических объектов на устройства вывода*

Предположим, вам нужно напечатать документ, открытый в текстовом редакторе. В этом случае ОС просто отправляет DC окна этого приложения на принтер. Контексты устройств, связанные с другими откртыми в данный момент окнами игнорируются.

Контекст устройства представляет собой структуру в памяти. Разработчики могу работать с ней только через WinAPI функции. Каждый DC содержит **аппаратно-зависимую битовую карту** (Device Depended Bitmap или DDB). **Битовая карта** - это представление поверхности для рисования в памяти. Все операции над графическими объектами в контексте устройства отражаются на соответствующей битовой карте. Следовательно она хранит результат всех этих операцй.
