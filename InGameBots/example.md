# Пример бота для 2 Diablo 2

## Обзор игры Diablo 2

Мы узнали достаточно, чтобы написать простого внутриигрового бота. Он будет автоматизировать некоторые действия в известной игре Diablo 2. Её игровой процесс типичен для жанра RPG: игрок должен выполнять квесты, убивать монстров и развивать своего персонажа.

Наш бот будет следить за состоянием игрового персонажа. Как только один из его параметров (например здоровье) опустится ниже порогового значения, бот будет выполнять некоторое действие (например использовать зелье лечения).

Перед тем как начать разработку бота, следует подробно изучить интерфейс игры. Скриншот Diablo 2 приведён на иллюстрации 3-15. В центре экрана находится игровой персонаж. Слева и справа от него находятся монстры, один из которых выделен курсором мыши. В нижней части экрана находится панель управления. На ней есть четыре слота с зельями лечения, которые привязаны к горячим клавишам. Наш бот будет использовать предметы в этих слотах при необходимости.

![Интерфейс Diablo 2](diablo-interface.png)

**Иллюстрация 3-15.** *Скриншот окна Diablo 2*

Все параметры игрового персонажа приведены на иллюстрации 3-16. В верхней части левого окна находится общая информация о нём: имя Kain, класс Paladin, уровень 70, очки опыта 285,160,782. Ниже указаны параметры персонажа, влияющие на игровую механику. Например, параметр “Strength” определяет урон, наносимый монстрам при ударе.

![Игровой персонаж в Diablo 2](diablo-player.png)

**Иллюстрация 3-15.** *Параметры игрового персонажа*

Правое окно на иллюстрации 3-15 отображает дерево способностей персонажа. Способности позволяют наносить больше урона монстрам или увеличивать параметры персонажа. Каждая способность имеет свой уровень, который опредеяет её эффективность. Более подробная информация о параметрах и способностях персонажа достпна на [Wiki](diablo.gamepedia.com/Classes_(Diablo_II)).

В Diablo 2 есть однопользовательский и многопользовательский режимы игры. Мы будем рассматривать только однопользовательский. В нём вы сможете останавливать игру под отладчиком в любой момент на неограниченное время, чтобы исследовать память её процесса. В многопользовательском режиме это не будет работать из-за таймаутов. Если игровой клиент не отвечает какое-то время, сервер его отключит.

Чтобы протестировать нашего бота, вы можете купить игру Diablo 2 на [официальном сайте](eu.shop.battle.net/en-b/product/diablo-ii) разработчика. Либо вы можете воспользоваться бесплатным клоном игры под названием [Flaire](http://flarerpg.org). В этом случае вам придётся самостоятельно разработать бота, следуя рассмотренным далее приёмам. Diablo 2 отличается от своего клона интерфейсом и сложностью. Память процесса оригинальной игры намного сложнее анализировать из-за большого количество вспомогательных библиотек.

## Реализация бота

Прежде всего, стоит чётко определить наши цели. Мы не собираемся взламывать игру, то есть нарушать её правила и вмешиваться в механику игрового процесса. Примеры подобных взломов вы можете найти в статьях Jan Miller:

* extreme-gamerz.org/diablo2/viewdiablo2/hackingdiablo2

* www.battleforums.com/threads/howtohackd2-edition-2.111214

Наш бот не нарушает правила игры. Он реагирует на изменение состояния персонажа и симулирует действие. При этом состояние всех игровых объектов меняется согласно правилам. Процесс Diablo 2 продолжает работать по своим оригинальным алгоритмам так же, как если бы действия совершал игрок.

Мы рассмотрели параметры игрового персонажа. Из них проще всего контролировать уровень здоровья. Когда персонаж получает урон от монстров, здоровье уменьшается. При использовании зелья лечения - увеличивается. Учитывая эту механику, наш бот может работать по следующему алгоритму:

1. Прочитать текущий уровень здоровья игрового персонажа.

2. Сравнить этот уровень с пороговоым значением.

3. Если здоровье меньше порога, использовать зелье лечения.

Этот простой алгоритм позволит игровому персонажу выживать до тех пор, пока у него остаются зелья лечения. Однако, несмотря на его простоту, для реализации бота нам придётся детально изучить память процесса Diablo 2.

## Исследование памяти процесса Diablo 2



