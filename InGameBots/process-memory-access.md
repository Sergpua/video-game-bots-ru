# Доступ к памяти процесса

Мы научились вручную искать переменную в памяти процесса. Пришло время написать код, для автоматизации этого поиска. Вутриигровые боты не могут использовать программу-отладчик (например OllyDbg). Вместо этого они должны сами реализовывать необходимые функции отладчика.

## Открытие процесса

Как вы помните, перед началом работы с памятью процесса к нему нужно подключить отладчик. После этого он получает полный доступ к адресному пространства процесса. Мы выполняли это действие через диалог интерфейса пользователя. То же самое должен уметь выполнять внутриигровой бот. Рассмотрим, какими WinAPI функциями он может воспользоваться для этого.

Практически все объекты и ресурсы Windows доступны через их дескрипторы. WinAPI функция `OpenProcess` возвращает дескриптор указнного процесса. У каждого процесса, запущенного в системе, есть уникальный номер или **идентификатор** (process identifier или PID). Его мы должны передать в `OpenProcess` входным параметром. Получив дескриптор, мы можем обращаться к памяти процесса с помощью других WinAPI функций.

Windows отвечает за распределение своих ресурсов между запущенными процессами. Один из этих ресурсов - память. Если любой процесс вегда будет иметь доступ к памяти других процессов, это может привести к сбоям в их работе. Система в целом будет ненадёжна. Поэтому ОС имеет специальный механизм защиты доступа к своим объектам. Рассмотрим его подробнее.

В архитектуре Windows разработчику пользовательских приложений предоставляются высокоуровневые абстракции к ресурсам ОС. Объекты Windows (например процессы) также используют эти абстракции. Дугими словами, одни объекты служат обёртками для системных ресурсов и предоставляют другим объектам единообразный интерфейс к этим ресурсам. Такой подход упрощает интерфейсы для разработки как системных библиотек Windows, так и пользовательских приложений.

Представим, что мы разрабатываем пользовательское приложение, например внутриигрового бота. Каким образом оно может взаимодействовать с каким-нибудь Windows объектом? Каждый объект представляет собой структуру, состоящую из **заголовка** (header) и **тела** (body). Тело содержит специфичные для данного типа объектов данные. Заголовок же метаинформацию о процессе, которая используется **Менеджером Объектов** (или Object Manager). Именно он предоставляет доступ к ресусам ОС через соответствующие им объекты.

**Модель безопасности Windows** ограничивает процессам доступ к системным объектам и различным действиям, требущих прав администратора. Можно сказать, что Менеджер Объектов реализует модель безпасности Windows. Согласно ей, процесс должен иметь специалные привилегии, чтобы получить доступ к памяти другого через вызов `OpenProcess`.

